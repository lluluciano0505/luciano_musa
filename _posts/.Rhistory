theme_void() +
theme(
panel.border = element_rect(color = "gray40", fill = NA, linewidth = 0.5)
)
# ============================================================
# PART 7: cowplot 拼合
# ============================================================
final_map <- ggdraw(main_map) +
draw_plot(inset_map,      x = 0.01, y = 0.72, width = 0.18, height = 0.14) +
draw_plot(bi_legend_plot, x = 0.72, y = 0.03, width = 0.18, height = 0.18)
final_map
main_map <- ggplot() +
# 底图淡化（非POI退为背景）
geom_sf(
data        = bi_data,
aes(fill    = bi_class),
color       = "white",
linewidth   = 0.07,
alpha       = 0.25,
show.legend = FALSE
) +
bi_scale_fill(pal = my_pal, dim = 3, na.value = "gray95") +
# POI 半透明填色
geom_sf(
data      = poi_tracts,
fill      = alpha("#F4A261", 0.85),
color     = NA
) +
# POI 描边
geom_sf(
data      = poi_tracts,
fill      = NA,
color     = "#E76F51",
linewidth = 0.7
) +
# POI 图例
geom_point(
aes(x = -Inf, y = -Inf,
color = "Potential Investment Zone\n(Low Poverty + Emerging Income)"),
size = 0
) +
scale_color_manual(
name   = NULL,
values = c("Potential Investment Zone\n(Low Poverty + Emerging Income)" = "#E76F51"),
guide  = guide_legend(
override.aes = list(
fill  = alpha("#F4A261", 0.85),
color = "#E76F51",
shape = 22,
size  = 5
)
)
) +
# North arrow
annotation_north_arrow(
location    = "tl",
which_north = "true",
style = north_arrow_fancy_orienteering(
fill     = c("gray20", "white"),
line_col = "gray20",
text_col = "gray20"
),
height = unit(1.0, "cm"),
width  = unit(1.0, "cm"),
pad_x  = unit(0.3, "cm"),
pad_y  = unit(0.3, "cm")
) +
# Scale bar
annotation_scale(
location   = "bl",
width_hint = 0.25,
style      = "bar",
text_cex   = 0.7,
line_col   = "gray20",
text_col   = "gray20"
) +
# 社区标注
geom_shadowtext(
data = neighborhoods,
aes(x = x, y = y, label = label,
fontface = ifelse(bold, "bold", "plain")),
size       = 2.6,
color      = "gray10",
bg.color   = "white",
bg.r       = 0.18,
lineheight = 0.85
) +
coord_sf(xlim = c(-75.30, -74.95), ylim = c(39.86, 40.14)) +
theme_void(base_family = "sans") +
theme(
plot.title      = element_text(size = 13, face = "bold",    margin = margin(b = 3)),
plot.subtitle   = element_text(size = 9,  color = "gray30", margin = margin(b = 6)),
plot.caption    = element_text(size = 6.5,color = "gray50", margin = margin(t = 6)),
plot.margin     = margin(10, 10, 10, 10),
legend.position = c(0.85, 0.30),   # ← y 从 0.55 改成 0.30，往下移
legend.text     = element_text(size = 7.5, color = "gray20"),
legend.key      = element_rect(fill = NA, color = NA)
) +
labs(
title    = "Philadelphia: Income vs. Poverty — Where Is the Opportunity?",
subtitle = "Bivariate map: Median Household Income × Poverty Rate by Census Tract | ACS 2023 5-Year Estimates",
caption  = "Source: U.S. Census Bureau via tidycensus | Roads & boundaries: TIGER/Line 2023"
)
# ============================================================
my_pal <- "GrPink"
poi_tracts <- bi_data |>
filter(bi_class %in% c("1-1", "2-1"))
neighborhoods <- data.frame(
label = c("Center City", "University City", "Fishtown /\nKensington",
"Northwest Philly", "South Philadelphia"),
x     = c(-75.165, -75.210, -75.130, -75.225, -75.175),
y     = c(39.952,  39.952,  39.978,  40.039,  39.940),
bold  = c(TRUE,    FALSE,   FALSE,   FALSE,   FALSE)
)
main_map <- ggplot() +
# 底图淡化（非POI退为背景）
geom_sf(
data        = bi_data,
aes(fill    = bi_class),
color       = "white",
linewidth   = 0.07,
alpha       = 0.25,
show.legend = FALSE
) +
bi_scale_fill(pal = my_pal, dim = 3, na.value = "gray95") +
# POI 半透明填色
geom_sf(
data      = poi_tracts,
fill      = alpha("#F4A261", 0.85),
color     = NA
) +
# POI 描边
geom_sf(
data      = poi_tracts,
fill      = NA,
color     = "#E76F51",
linewidth = 0.7
) +
# POI 图例
geom_point(
aes(x = -Inf, y = -Inf,
color = "Potential Investment Zone\n(Low Poverty + Emerging Income)"),
size = 0
) +
scale_color_manual(
name   = NULL,
values = c("Potential Investment Zone\n(Low Poverty + Emerging Income)" = "#E76F51"),
guide  = guide_legend(
override.aes = list(
fill  = alpha("#F4A261", 0.85),
color = "#E76F51",
shape = 22,
size  = 5
)
)
) +
# North arrow
annotation_north_arrow(
location    = "tl",
which_north = "true",
style = north_arrow_fancy_orienteering(
fill     = c("gray20", "white"),
line_col = "gray20",
text_col = "gray20"
),
height = unit(1.0, "cm"),
width  = unit(1.0, "cm"),
pad_x  = unit(0.3, "cm"),
pad_y  = unit(0.3, "cm")
) +
# Scale bar
annotation_scale(
location   = "bl",
width_hint = 0.25,
style      = "bar",
text_cex   = 0.7,
line_col   = "gray20",
text_col   = "gray20"
) +
# 社区标注
geom_shadowtext(
data = neighborhoods,
aes(x = x, y = y, label = label,
fontface = ifelse(bold, "bold", "plain")),
size       = 2.6,
color      = "gray10",
bg.color   = "white",
bg.r       = 0.18,
lineheight = 0.85
) +
coord_sf(xlim = c(-75.30, -74.95), ylim = c(39.86, 40.14)) +
theme_void(base_family = "sans") +
theme(
plot.title      = element_text(size = 13, face = "bold",    margin = margin(b = 3)),
plot.subtitle   = element_text(size = 9,  color = "gray30", margin = margin(b = 6)),
plot.caption    = element_text(size = 6.5,color = "gray50", margin = margin(t = 6)),
plot.margin     = margin(10, 10, 10, 10),
legend.position = c(0.85, 0.30),   # ← y 从 0.55 改成 0.30，往下移
legend.text     = element_text(size = 7.5, color = "gray20"),
legend.key      = element_rect(fill = NA, color = NA)
) +
labs(
title    = "Philadelphia: Income vs. Poverty — Where Is the Opportunity?",
subtitle = "Bivariate map: Median Household Income × Poverty Rate by Census Tract | ACS 2023 5-Year Estimates",
caption  = "Source: U.S. Census Bureau via tidycensus | Roads & boundaries: TIGER/Line 2023"
)
# ============================================================
# PART 5: Bivariate 图例
# ============================================================
bi_legend_plot <- bi_legend(
pal  = my_pal,
dim  = 3,
xlab = "Higher Income",
ylab = "Higher Poverty",
size = 8
)
# ============================================================
# PART 6: Inset 小地图
# ============================================================
inset_map <- ggplot() +
geom_sf(data = pa_state,      fill = "gray90", color = "gray60", linewidth = 0.3) +
geom_sf(data = pa_counties,   fill = "gray85", color = "gray70", linewidth = 0.1) +
geom_sf(data = philly_county, fill = "#2c7bb6", color = "white", linewidth = 0.4) +
theme_void() +
theme(
panel.border = element_rect(color = "gray40", fill = NA, linewidth = 0.5)
)
# ============================================================
# PART 7: cowplot 拼合
# ============================================================
final_map <- ggdraw(main_map) +
draw_plot(inset_map,      x = 0.01, y = 0.72, width = 0.18, height = 0.14) +
draw_plot(bi_legend_plot, x = 0.72, y = 0.03, width = 0.18, height = 0.18)
final_map
# ============================================================
# PART 4: 主地图
# ============================================================
my_pal <- "GrPink"
poi_tracts <- bi_data |>
filter(bi_class %in% c("1-1", "2-1"))
neighborhoods <- data.frame(
label = c("Center City", "University City", "Fishtown /\nKensington",
"Northwest Philly", "South Philadelphia"),
x     = c(-75.165, -75.210, -75.130, -75.225, -75.175),
y     = c(39.952,  39.952,  39.978,  40.039,  39.940),
bold  = c(TRUE,    FALSE,   FALSE,   FALSE,   FALSE)
)
main_map <- ggplot() +
# 底图淡化（非POI退为背景）
geom_sf(
data        = bi_data,
aes(fill    = bi_class),
color       = "white",
linewidth   = 0.07,
alpha       = 0.25,
show.legend = FALSE
) +
bi_scale_fill(pal = my_pal, dim = 3, na.value = "gray95") +
# POI 半透明填色
geom_sf(
data      = poi_tracts,
fill      = alpha("#F4A261", 0.85),
color     = NA
) +
# POI 描边
geom_sf(
data      = poi_tracts,
fill      = NA,
color     = "#E76F51",
linewidth = 0.7
) +
# POI 图例
geom_point(
aes(x = -Inf, y = -Inf,
color = "Potential Investment Zone\n(Low Poverty + Emerging Income)"),
size = 0
) +
scale_color_manual(
name   = NULL,
values = c("Potential Investment Zone\n(Low Poverty + Emerging Income)" = "#E76F51"),
guide  = guide_legend(
override.aes = list(
fill  = alpha("#F4A261", 0.85),
color = "#E76F51",
shape = 22,
size  = 5
)
)
) +
# North arrow
annotation_north_arrow(
location    = "tl",
which_north = "true",
style = north_arrow_fancy_orienteering(
fill     = c("gray20", "white"),
line_col = "gray20",
text_col = "gray20"
),
height = unit(1.0, "cm"),
width  = unit(1.0, "cm"),
pad_x  = unit(0.3, "cm"),
pad_y  = unit(0.3, "cm")
) +
# Scale bar
annotation_scale(
location   = "bl",
width_hint = 0.25,
style      = "bar",
text_cex   = 0.7,
line_col   = "gray20",
text_col   = "gray20"
) +
# 社区标注
geom_shadowtext(
data = neighborhoods,
aes(x = x, y = y, label = label,
fontface = ifelse(bold, "bold", "plain")),
size       = 2.6,
color      = "gray10",
bg.color   = "white",
bg.r       = 0.18,
lineheight = 0.85
) +
coord_sf(xlim = c(-75.30, -74.95), ylim = c(39.86, 40.14)) +
theme_void(base_family = "sans") +
theme(
# 标题
plot.title      = element_text(size = 14, face = "bold",
color = "gray10", margin = margin(b = 4)),
plot.subtitle   = element_text(size = 8.5, color = "gray40",
margin = margin(b = 8)),
plot.caption    = element_text(size = 6.5, color = "gray55",
hjust = 0,        # 左对齐
margin = margin(t = 10)),
# 整体边距
plot.margin     = margin(14, 14, 10, 14),
# 背景
plot.background = element_rect(fill = "white", color = NA),
# POI 图例
legend.position   = c(0.85, 0.30),
legend.text       = element_text(size = 7.5, color = "gray20",
lineheight = 1.2),
legend.key        = element_rect(fill = NA, color = NA),
legend.key.size   = unit(0.5, "cm"),
legend.background = element_rect(fill = alpha("white", 0.7),
color = NA)
) +
labs(
title    = "Philadelphia: Income vs. Poverty — Where Is the Opportunity?",
subtitle = paste0(
"Orange tracts (low poverty rate + emerging income) signal undervalued investment zones. ",
"Background shows income-poverty profile
# ============================================================
# PART 5: Bivariate 图例
# ============================================================
bi_legend_plot <- bi_legend(
pal  = my_pal,
dim  = 3,
xlab = "Higher Income",
# ============================================================
# PART 4: 主地图
# ============================================================
my_pal <- "GrPink"
poi_tracts <- bi_data |>
filter(bi_class %in% c("1-1", "2-1"))
neighborhoods <- data.frame(
label = c("Center City", "University City", "Fishtown /\nKensington",
"Northwest Philly", "South Philadelphia"),
x     = c(-75.165, -75.210, -75.130, -75.225, -75.175),
y     = c(39.952,  39.952,  39.978,  40.039,  39.940),
bold  = c(TRUE,    FALSE,   FALSE,   FALSE,   FALSE)
)
main_map <- ggplot() +
# 底图淡化（非POI退为背景）
geom_sf(
data        = bi_data,
aes(fill    = bi_class),
color       = "white",
linewidth   = 0.07,
alpha       = 0.25,
show.legend = FALSE
) +
bi_scale_fill(pal = my_pal, dim = 3, na.value = "gray95") +
# POI 填色
geom_sf(
data      = poi_tracts,
fill      = alpha("#F4A261", 0.85),
color     = NA
) +
# POI 描边
geom_sf(
data      = poi_tracts,
fill      = NA,
color     = "#E76F51",
linewidth = 0.7
) +
# POI 图例（虚拟点触发 ggplot 图例系统）
geom_point(
aes(x = -Inf, y = -Inf,
color = "Potential Investment Zone\n(Low Poverty + Emerging Income)"),
size = 0
) +
scale_color_manual(
name   = NULL,
values = c("Potential Investment Zone\n(Low Poverty + Emerging Income)" = "#E76F51"),
guide  = guide_legend(
override.aes = list(
fill  = alpha("#F4A261", 0.85),
color = "#E76F51",
shape = 22,
size  = 5
)
)
) +
# North arrow
annotation_north_arrow(
location    = "tl",
which_north = "true",
style = north_arrow_fancy_orienteering(
fill     = c("gray20", "white"),
line_col = "gray20",
text_col = "gray20"
),
height = unit(1.0, "cm"),
width  = unit(1.0, "cm"),
pad_x  = unit(0.3, "cm"),
pad_y  = unit(0.3, "cm")
) +
# Scale bar
annotation_scale(
location   = "bl",
width_hint = 0.25,
style      = "bar",
text_cex   = 0.7,
line_col   = "gray20",
text_col   = "gray20"
) +
# 社区标注
geom_shadowtext(
data = neighborhoods,
aes(x = x, y = y, label = label,
fontface = ifelse(bold, "bold", "plain")),
size       = 2.6,
color      = "gray10",
bg.color   = "white",
bg.r       = 0.18,
lineheight = 0.85
) +
coord_sf(xlim = c(-75.30, -74.95), ylim = c(39.86, 40.14)) +
theme_void(base_family = "sans") +
theme(
# 标题
plot.title      = element_text(size = 14, face = "bold",
color = "gray10", margin = margin(b = 4)),
plot.subtitle   = element_text(size = 8.5, color = "gray40",
margin = margin(b = 8)),
plot.caption    = element_text(size = 6.5, color = "gray55",
hjust = 0,
margin = margin(t = 10)),
# 整体边距
plot.margin     = margin(14, 14, 10, 14),
# 白底
plot.background = element_rect(fill = "white", color = NA),
# POI 图例
legend.position   = c(0.85, 0.30),
legend.text       = element_text(size = 7.5, color = "gray20",
lineheight = 1.2),
legend.key        = element_rect(fill = NA, color = NA),
legend.key.size   = unit(0.5, "cm"),
legend.background = element_rect(fill = alpha("white", 0.7), color = NA)
) +
labs(
title    = "Philadelphia: Income vs. Poverty — Where Is the Opportunity?",
subtitle = paste0(
"Orange tracts (low poverty rate + emerging income) signal undervalued investment zones. ",
"Background shows income-poverty profile by census tract.\n",
"ACS 2023 5-Year Estimates | Quantile classification (3×3)"
),
caption  = paste0(
"Source: U.S. Census Bureau via tidycensus | Boundaries: TIGER/Line 2023\n",
"Note: 'Potential Investment Zone' = tracts in lowest tercile of poverty rate ",
"AND lowest or middle tercile of median household income (bi_class 1-1 and 2-1)."
)
)
# ============================================================
# PART 5: Bivariate 图例
# ============================================================
bi_legend_plot <- bi_legend(
pal  = my_pal,
dim  = 3,
xlab = "Higher Income",
ylab = "Higher Poverty",
size = 8
)
# ============================================================
# PART 6: Inset 小地图
# ============================================================
inset_map <- ggplot() +
geom_sf(data = pa_state,      fill = "gray90", color = "gray60", linewidth = 0.3) +
geom_sf(data = pa_counties,   fill = "gray85", color = "gray70", linewidth = 0.1) +
geom_sf(data = philly_county, fill = "#2c7bb6", color = "white", linewidth = 0.4) +
theme_void() +
theme(
panel.border = element_rect(color = "gray40", fill = NA, linewidth = 0.5)
)
# ============================================================
# PART 7: cowplot 拼合
# ============================================================
final_map <- ggdraw(main_map) +
draw_plot(inset_map,      x = 0.01, y = 0.72, width = 0.18, height = 0.14) +
draw_plot(bi_legend_plot, x = 0.72, y = 0.03, width = 0.18, height = 0.18)
final_map
